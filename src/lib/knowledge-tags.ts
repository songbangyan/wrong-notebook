// 标准化知识点标签库
// 用于统一AI生成的标签，避免同一知识点有多种表达

export const STANDARD_TAGS = {
    // ==================== 数学 ====================
    math: {
        // 代数
        algebra: {
            equations: [
                "一元一次方程",
                "一元一次方程的应用",
                "一元二次方程",
                "一元二次方程求根公式",
                "一元二次方程配方法",
                "一元二次方程因式分解法",
                "一元二次方程的应用",
                "二元一次方程组",
                "三元一次方程组",
                "分式方程",
                "无理方程",
            ],
            inequalities: [
                "一元一次不等式",
                "一元一次不等式组",
                "一元二次不等式",
                "不等式的性质",
                "不等式的应用",
            ],
            expressions: [
                "整式",
                "多项式",
                "因式分解",
                "提公因式法",
                "公式法分解",
                "十字相乘法",
                "分组分解法",
                "分式",
                "分式的运算",
                "二次根式",
                "二次根式的化简",
            ],
            functions: [
                "函数的概念",
                "函数的图像",
                "一次函数",
                "一次函数的性质",
                "一次函数的应用",
                "反比例函数",
                "反比例函数的性质",
                "反比例函数的图像",
                "二次函数",
                "二次函数的图像",
                "二次函数的性质",
                "二次函数顶点式",
                "二次函数一般式",
                "二次函数的应用",
                "函数综合应用",
            ],
        },

        // 几何
        geometry: {
            basic: [
                "点线面的关系",
                "角的概念",
                "角度计算",
                "对顶角",
                "余角和补角",
                "平行线的性质",
                "平行线的判定",
                "垂线",
                "距离",
            ],
            triangles: [
                "三角形",
                "三角形的分类",
                "三角形三边关系",
                "三角形内角和",
                "三角形外角性质",
                "等腰三角形",
                "等腰三角形的性质",
                "等腰三角形的判定",
                "等边三角形",
                "直角三角形",
                "勾股定理",
                "勾股定理逆定理",
                "勾股定理的应用",
                "全等三角形",
                "全等三角形的判定",
                "全等三角形的性质",
                "相似三角形",
                "相似三角形的判定",
                "相似三角形的性质",
                "相似三角形的应用",
                "锐角三角函数",
                "正弦定理",
                "余弦定理",
            ],
            quadrilaterals: [
                "四边形",
                "平行四边形",
                "平行四边形的性质",
                "平行四边形的判定",
                "矩形",
                "矩形的性质",
                "矩形的判定",
                "菱形",
                "菱形的性质",
                "菱形的判定",
                "正方形",
                "梯形",
                "等腰梯形",
            ],
            circles: [
                "圆",
                "圆的性质",
                "圆周角定理",
                "圆心角定理",
                "弦",
                "弦的性质",
                "切线",
                "切线长定理",
                "切线的性质",
                "切线的判定",
                "圆与圆的位置关系",
                "直线与圆的位置关系",
                "圆的面积",
                "扇形面积",
                "弧长计算",
            ],
            solid: [
                "立体图形",
                "棱柱",
                "棱锥",
                "圆柱",
                "圆锥",
                "球",
                "表面积",
                "体积计算",
                "三视图",
                "展开图",
            ],
        },

        // 数与式
        numbers: [
            "有理数",
            "有理数的运算",
            "有理数的加减",
            "有理数的乘除",
            "有理数的乘方",
            "无理数",
            "实数",
            "实数的运算",
            "数轴",
            "绝对值",
            "绝对值的性质",
            "绝对值方程",
            "相反数",
            "倒数",
            "平方根",
            "算术平方根",
            "立方根",
            "科学计数法",
            "近似数",
            "有效数字",
        ],

        // 统计与概率
        statistics: [
            "数据的收集",
            "数据的整理",
            "统计图表",
            "条形统计图",
            "折线统计图",
            "扇形统计图",
            "频数分布表",
            "频数分布直方图",
            "平均数",
            "加权平均数",
            "中位数",
            "众数",
            "极差",
            "方差",
            "标准差",
            "概率",
            "概率的计算",
            "古典概型",
            "频率与概率",
        ],
    },

    // ==================== 物理 ====================
    physics: {
        // 力学
        mechanics: {
            basic: [
                "长度的测量",
                "时间的测量",
                "速度",
                "平均速度",
                "瞬时速度",
                "匀速直线运动",
                "变速运动",
                "加速度",
                "自由落体运动",
            ],
            force: [
                "力",
                "力的作用效果",
                "力的合成",
                "力的分解",
                "重力",
                "重心",
                "弹力",
                "胡克定律",
                "摩擦力",
                "滑动摩擦力",
                "静摩擦力",
                "摩擦力的应用",
                "二力平衡",
                "牛顿第一定律",
                "惯性",
                "牛顿第二定律",
                "牛顿第三定律",
            ],
            pressure: [
                "压强",
                "压强的计算",
                "液体压强",
                "大气压强",
                "流体压强",
                "浮力",
                "阿基米德原理",
                "浮力的应用",
                "物体的浮沉条件",
            ],
            work: [
                "功",
                "功的计算",
                "功率",
                "机械效率",
                "简单机械",
                "杠杆",
                "杠杆平衡条件",
                "滑轮",
                "定滑轮",
                "动滑轮",
                "滑轮组",
                "斜面",
                "机械能",
                "动能",
                "势能",
                "重力势能",
                "弹性势能",
                "机械能守恒",
                "能量转化",
            ],
        },

        // 电学
        electricity: {
            basic: [
                "电荷",
                "摩擦起电",
                "电流",
                "电流的方向",
                "电压",
                "电阻",
                "影响电阻的因素",
                "变阻器",
            ],
            circuits: [
                "电路",
                "电路图",
                "串联电路",
                "串联电路的特点",
                "并联电路",
                "并联电路的特点",
                "欧姆定律",
                "欧姆定律的应用",
                "电阻的串联",
                "电阻的并联",
                "电路故障分析",
                "电路设计",
            ],
            power: [
                "电功",
                "电功率",
                "电功率的计算",
                "额定功率",
                "实际功率",
                "焦耳定律",
                "电热",
                "电热器",
                "家庭电路",
                "安全用电",
            ],
            magnetism: [
                "磁现象",
                "磁场",
                "磁感线",
                "电流的磁效应",
                "电磁铁",
                "电磁继电器",
                "电动机",
                "电磁感应",
                "发电机",
            ],
        },

        // 光学
        optics: [
            "光的直线传播",
            "光速",
            "光的反射",
            "平面镜成像",
            "光的折射",
            "折射定律",
            "透镜",
            "凸透镜",
            "凸透镜成像规律",
            "凸透镜的应用",
            "凹透镜",
            "眼睛和眼镜",
            "显微镜",
            "望远镜",
            "光的色散",
            "光的三原色",
        ],

        // 热学
        thermology: [
            "温度",
            "温度计",
            "熔化和凝固",
            "熔点",
            "汽化和液化",
            "沸点",
            "升华和凝华",
            "分子动理论",
            "内能",
            "比热容",
            "热量",
            "热值",
            "热机",
            "热机效率",
            "能量守恒定律",
        ],

        // 声学
        acoustics: [
            "声音的产生",
            "声音的传播",
            "声速",
            "音调",
            "响度",
            "音色",
            "噪声",
            "超声波",
            "次声波",
        ],
    },

    // ==================== 化学 ====================
    chemistry: {
        basic: [
            "物质的变化",
            "物理变化",
            "化学变化",
            "物质的性质",
            "物理性质",
            "化学性质",
            "分子",
            "原子",
            "离子",
            "元素",
            "化学式",
            "化学方程式",
            "化学方程式的配平",
            "质量守恒定律",
        ],
        elements: [
            "金属",
            "金属的性质",
            "金属活动性顺序",
            "合金",
            "铁",
            "铝",
            "铜",
            "非金属",
            "碳",
            "硅",
            "氧气",
            "氢气",
            "氮气",
            "元素周期表",
            "化合价",
        ],
        compounds: [
            "氧化物",
            "酸",
            "常见的酸",
            "酸的性质",
            "碱",
            "常见的碱",
            "碱的性质",
            "盐",
            "常见的盐",
            "盐的性质",
            "酸碱盐",
            "中和反应",
            "复分解反应",
        ],
        reactions: [
            "化合反应",
            "分解反应",
            "置换反应",
            "复分解反应",
            "氧化反应",
            "还原反应",
            "氧化还原反应",
            "燃烧",
            "缓慢氧化",
            "催化剂",
        ],
        calculation: [
            "相对原子质量",
            "相对分子质量",
            "化学式的计算",
            "化学方程式的计算",
            "溶液",
            "溶解度",
            "饱和溶液",
            "不饱和溶液",
            "溶质质量分数",
        ],
    },
};

// 标签别名映射表 - 将AI可能生成的不同表达映射到标准标签
export const TAG_ALIASES: Record<string, string> = {
    // ========== 方程相关 ==========
    "二次方程": "一元二次方程",
    "一元2次方程": "一元二次方程",
    "2次方程": "一元二次方程",
    "求根公式": "一元二次方程求根公式",
    "配方法": "一元二次方程配方法",
    "quadratic equation": "一元二次方程",
    "linear equation": "一元一次方程",
    "一次方程": "一元一次方程",
    "方程": "一元一次方程",
    "方程组": "二元一次方程组",

    // ========== 几何基础 ==========
    "勾股": "勾股定理",
    "毕达哥拉斯定理": "勾股定理",
    "毕氏定理": "勾股定理",
    "Pythagorean": "勾股定理",

    // 三角形相关
    "三角形相似": "相似三角形",
    "相似": "相似三角形",
    "三角形全等": "全等三角形",
    "全等": "全等三角形",
    "等腰": "等腰三角形",
    "等边": "等边三角形",
    "直角三角形性质": "直角三角形",

    // 四边形
    "平行四边形性质": "平行四边形",
    "矩形性质": "矩形",
    "菱形性质": "菱形",

    // 圆相关
    "圆的性质": "圆",
    "圆周角": "圆周角定理",
    "圆心角": "圆心角定理",
    "切线性质": "切线",

    // 立体几何/三视图
    "左视图": "三视图",
    "主视图": "三视图",
    "俯视图": "三视图",
    "视图": "三视图",
    "三视": "三视图",
    "立体图形的三视图": "三视图",

    // ========== 物理-运动相关 ==========
    "匀速运动": "匀速直线运动",
    "匀速": "匀速直线运动",
    "uniform motion": "匀速直线运动",
    "变速": "变速运动",
    "加速运动": "变速运动",
    "加速度": "变速运动",
    "速度计算": "速度",
    "平均速度计算": "平均速度",

    // 物理-力学
    "力的概念": "力",
    "力学": "力",
    "牛一": "牛顿第一定律",
    "牛二": "牛顿第二定律",
    "牛三": "牛顿第三定律",
    "惯性定律": "牛顿第一定律",
    "重力加速度": "重力",
    "摩擦": "摩擦力",
    "浮力计算": "浮力",
    "压强计算": "压强",
    "液体压强计算": "液体压强",

    // 物理-电学
    "欧姆": "欧姆定律",
    "串联": "串联电路",
    "并联": "并联电路",
    "电路分析": "电路",
    "电功率计算": "电功率",
    "电功计算": "电功",

    // ========== 数值相关 ==========
    "绝对值的性质": "绝对值",
    "非负数": "绝对值",
    "非负数的性质": "绝对值",
    "absolute value": "绝对值",
    "有理数运算": "有理数的运算",
    "实数运算": "实数的运算",
    "科学记数法": "科学计数法",

    // ========== 函数相关 ==========
    "二次函数性质": "二次函数的性质",
    "二次函数图像": "二次函数的图像",
    "抛物线": "二次函数",
    "反比例": "反比例函数",
    "一次函数图像": "一次函数的图像",
    "一次函数性质": "一次函数的性质",
    "函数": "函数的概念",

    // ========== 代数相关 ==========
    "因式": "因式分解",
    "分解因式": "因式分解",
    "提公因式": "提公因式法",
    "十字相乘": "十字相乘法",
    "分式运算": "分式的运算",
    "根式": "二次根式",
    "化简": "二次根式的化简",

    // ========== 统计概率 ==========
    "平均数计算": "平均数",
    "概率计算": "概率的计算",
    "统计": "统计图表",
    "方差计算": "方差",

    // ========== 化学相关 ==========
    "化学方程": "化学方程式",
    "配平": "化学方程式的配平",
    "氧化还原": "氧化还原反应",
    "中和": "中和反应",
    "酸碱": "酸碱盐",
    "溶液计算": "溶质质量分数",
    "溶解": "溶解度",
};

/**
 * 标准化标签 - 将AI生成的标签转换为标准标签
 * @param tag AI生成的原始标签
 * @returns 标准化后的标签
 */
export function normalizeTag(tag: string): string {
    const trimmed = tag.trim();

    // 1. 直接匹配别名
    if (TAG_ALIASES[trimmed]) {
        return TAG_ALIASES[trimmed];
    }

    // 2. 模糊匹配 - 检查是否包含标准标签
    const allStandardTags = getAllStandardTags();
    for (const standardTag of allStandardTags) {
        if (trimmed.includes(standardTag) || standardTag.includes(trimmed)) {
            return standardTag;
        }
    }

    // 3. 如果找不到匹配，返回原标签
    return trimmed;
}

/**
 * 标准化标签数组
 * @param tags AI生成的标签数组
 * @returns 标准化后的去重标签数组
 */
export function normalizeTags(tags: string[]): string[] {
    const normalized = tags.map(normalizeTag);
    // 去重
    return Array.from(new Set(normalized));
}

/**
 * 获取所有标准标签（扁平化）
 */
function getAllStandardTags(): string[] {
    const tags: string[] = [];

    // 递归提取标签
    function extractTags(obj: any): void {
        if (Array.isArray(obj)) {
            // 如果是数组，直接添加所有元素
            tags.push(...obj);
        } else if (typeof obj === 'object' && obj !== null) {
            // 如果是对象，递归处理所有值
            Object.values(obj).forEach(value => extractTags(value));
        }
    }

    extractTags(STANDARD_TAGS);
    return tags;
}

/**
 * 获取标签建议 - 基于已有标签和输入
 * @param input 用户输入
 * @param existingTags 已有的所有标签
 * @returns 建议的标签列表
 */
export function getTagSuggestions(input: string, existingTags: string[]): string[] {
    const allTags = [...new Set([...getAllStandardTags(), ...existingTags])];

    if (!input) {
        return allTags.slice(0, 10); // 返回前10个
    }

    const lowerInput = input.toLowerCase();
    const suggestions = allTags.filter(tag =>
        tag.toLowerCase().includes(lowerInput) ||
        lowerInput.includes(tag.toLowerCase())
    );

    return suggestions.slice(0, 10);
}
